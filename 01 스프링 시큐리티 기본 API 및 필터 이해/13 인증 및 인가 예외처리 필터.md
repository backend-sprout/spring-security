# ExceptionTranslationFilter 

ExceptionTranslationFilter 는 크게 두가지 예외를 처리한다.   

1. AuthenticationException
2. AccessDeniedException

**AuthenticationException**  
* **인증 예외 처리**     
* AuthenticationEntryPoint 호출 
    * 로그인 페이지 이동, 401 오류 코드 전달 등   
* 인증 예외가 발생하기전의 요청 정보를 저장   
    * RequestCache 구현체 : 사용자의 이전 요청 정보를 세션에 저장하고 이를 꺼내오는 캐시 매커니즘    
    * SavedRequest 구현체 : 사용자가 요청했던 request 파라미터 값들, 그 당시의 헤더값들 등이 저장된다.        
   
즉, 요청시 인증되지 않으면 로그인 요청페이지로 이동을 시킨다.            
이동 시키기 전에, 사용자의 요청 정보를 캐시에 저장을한다.        
여기서 로그인에 성공하면 캐시에서 이전 사용자 요청 정보를 꺼내서 요청 흐름을 이어갈 수 있도록한다.   
  
**AccessDeniedException**       
* **인가 예외 처리**        
* AccessDeniedHandler에서 예외 처리하도록 제공한다.    
  
**그렇다면 위와 같은 예외는 어느 클래스에서 발생시키는 것일까🤔?**               
위 두 에외는 FilterSecurityInterceptor 에서 발생한다.(throw)               
필터의 한 종류이며 SpringSecurity 가 관리하는 필터중에서도 맨 마지막에 위치해있다.       

그리고 이 필터의 바로 앞에 존재하는 필터는 이들을 예외처리하는 `ExceptionTranslationFilter`였던 것이다.   

```java
		try {
			chain.doFilter(request, response);
		} catch (Exception ex) {
			... //생략 
		} 
```
즉, 위와 같이 try-catch로 감싸서 `FilterSecurityInterceptor`필터를 호출하고 있다.  
 
정리하자면,    
FilterSecurityInterceptor 에서 안증/인가 예외가 발생하면      
ExceptionTranslationFilter 에서 인증/인가 예외를 처리하는 구조이다.      

# 예외처리 필터 흐름 

![image](https://user-images.githubusercontent.com/50267433/150917317-2398d097-87be-4b50-9bd3-de24ec8489ab.png)



